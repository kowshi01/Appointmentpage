<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form</title>
    <link rel="stylesheet" href="form.css">
</head>
<body>
    <form id="form" onsubmit="save(event)">
        <h1>Form</h1>
        <div class="div"></div>
        <div>
            <label for="name1"> Name : </label><br>
            <input type="text" id="name1" name="username"><br>
        </div>
        <div>
            <label for="email" > email : </label><br>
            <input type="text" id="email" name="emailid"><br><br>
        </div>
        <div>
            <input class="button" style="color: mediumvioletred;"  type="Submit" value="Submit">
        </div>
    </form>
    <div id="output">
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.2/axios.min.js"></script>
    <script>
        function save(event){
            event.preventDefault();
            const name=event.target.username.value;
            const emailid=event.target.emailid.value;
            const obj={
                name,
                emailid
            }
            //localStorage.setItem(obj.emailid,JSON.stringify(obj));
            axios.post("https://crudcrud.com/api/59479b55be4b4aa79a16054a462fa010/formData",obj)
            .then((respone)=>{
                showNewUser(respone);
                console.log(respone)})
            .catch((err)=>{
                console.log(err)})
            //showNewUser(obj);
        }
        window.addEventListener("DOMContentLoaded",()=>{
            const localStObj=localStorage;
            const localStorageKeys=Object.keys(localStObj)

            for(var i=0;i<localStorageKeys.length;i++){
                const key=localStorageKeys[i];
                const userString=localStObj[key];
                const userObj=JSON.parse(userString);
                showNewUser(userObj);
            }
        })
        function showNewUser(user){
            let parentNode=document.getElementById('output');
            let childHTML=`<h4 id='heading'> ${user.name} - ${user.emailid} <button onclick=edituser('${user.username},${user.emailid}')>Edit</button>
            <button onclick=deluser('${user.emailid}')>Delete</button></h4>`;
        parentNode.innerHTML=parentNode.innerHTML+childHTML;
        }
        function edituser(usern,mailid){
            usern=document.getElementById('name1').value;
            mailid=document.getElementById('email').value;
        deluser(mailid);
        }  
        function deluser(mailid) {
        localStorage.removeItem(mailid);
        removeFromScreen(mailid);
        } 
        function removeFromScreen(mailid){
        const parentNodee=document.getElementById('output');
        const childNodee=document.getElementById('heading');
        if(childNodee){
        parentNodee.removeChild(childNodee); 
        }
        } 
    </script>
</body>
</html>